<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>原神 縛りプレイルーレット ボス・縛りルーレット</title>
    <meta name="description" content="原神のボスや縛り内容を自動で抽選するWebツールです。マルチプレイ（1～4人）に対応し、キャラルーレットや武器縛りなど、詳細なカスタム設定も可能です。">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 画面固定ホームボタン -->
    <button id="homeButton" class="home-button">最初に戻る</button>

    <div class="container">
        <!-- 1. スタート画面 -->
        <div id="startScreen">
            <h1>原神縛りルーレット</h1>
            
            <div class="input-group">
                <label>プレイヤー数：</label>
                <div class="number-controls">
                    <button type="button" class="count-btn" onclick="adjustCount('playerCount', -1)">－</button>
                    <input type="number" id="playerCount" value="1" min="1" max="4" readonly>
                    <button type="button" class="count-btn" onclick="adjustCount('playerCount', 1)">＋</button>
                </div>
            </div>
            
            <div class="input-group">
                <label>縛りの数：</label>
                <div class="number-controls">
                    <button type="button" class="count-btn" onclick="adjustCount('bindCount', -1)">－</button>
                    <input type="number" id="bindCount" value="1" min="1" max="4" readonly>
                    <button type="button" class="count-btn" onclick="adjustCount('bindCount', 1)">＋</button>
                </div>
            </div>
            
            <div id="playerNameInputsContainer">
                <!-- JSで生成 -->
            </div>

            <div class="button-group">
                <button id="startAllButton">ボス＋縛りルーレット</button>
                <button id="startBossButton">ボスルーレットのみ</button>
                <button id="startBindButton">縛りルーレットのみ</button>
                <button id="showBindSelectionButton">詳細縛り設定</button>
                <button id="showCustomBindScreenButton">カスタム縛り設定</button>
            </div>

            <div style="margin-top: 10px; text-align: center;">
                <label class="checkbox-label">
                    <input type="checkbox" id="weeklyBossModeBindOnly">
                    週ボスモード（キャラルーレットで同じキャラが選ばれない）
                </label>
            </div>

            <div class="settings-group">
                <button id="showMemberSettingsButton" class="member-settings-button">メンバーの所持状況設定</button>
            </div>

            <div class="about-button-container">
                <button id="showAboutButton" class="about-button">このルーレットについて</button>
            </div>
        </div>

        <!-- 2. カスタム縛り設定画面 -->
        <div id="customBindScreen" class="hidden">
            <h2>カスタム縛り設定</h2>
            <p>実行したい縛りにチェックを入れ、詳細を設定してください。</p>
            
            <div class="custom-section">
                <h3>ボスの選択</h3>
                <select id="customBossSelect">
                    <!-- JSで五十音順に生成 -->
                </select>
            </div>

            <div id="customBindsCommon">
                <h3>共通の縛り</h3>
                <div id="customBindGrid" class="custom-bind-grid"></div>
                <div class="custom-bind-checkboxes">
                    <h3>追加ルール</h3>
                    <div id="customBindButtonsCommon" class="button-group-checkbox"></div>
                    <label class="checkbox-label">
                        <input type="checkbox" id="weeklyBossModeCustom">
                        週ボスモード（キャラルーレットで同じキャラが選ばれない）
                    </label>
                </div>
            </div>
            <div id="customBindsPlayersContainer"></div>
            <button id="executeCustomBindsButton">この条件で実行</button>
        </div>
 
        <!-- 3. 詳細縛り選択画面 -->
        <div id="bindSelection" class="hidden">
            <h2>縛りを選択してください</h2>
            <div id="bindButtons" class="button-group-checkbox"></div>
            <div style="margin-top: 20px;">
                <label class="checkbox-label">
                    <input type="checkbox" id="weeklyBossModeSelection">
                    週ボスモード（キャラルーレットで同じキャラが選ばれない）
                </label>
            </div>
            <button id="executeSelectionButton">選択した縛りで実行</button>
        </div>

        <!-- 4. ルーレット実行画面 -->
        <div id="rouletteScreen" class="hidden">
            <h2 id="currentPlayerNameDisplay"></h2>
            <div class="roulette-container">
                <canvas id="rouletteCanvas" width="500" height="500"></canvas>
            </div>
            <div class="controls">
                <button id="spinButton">スピン</button>
                <button id="stopButton" disabled>ストップ</button>
                <button id="nextButton" class="hidden">次へ</button>
                <button id="notOwnedButton" class="hidden">持っていない（リロール）</button>
            </div>
            <div id="popup" class="popup"></div>
        </div>

        <!-- 5. 結果表示画面 -->
        <div id="resultScreen" class="hidden">
            <h1>結果</h1>
            <div id="results"></div>
            <button id="backToStartButton">最初に戻る</button>
        </div>
    </div>

    <!-- 6. 所持状況設定モーダル -->
    <div id="memberSettingsModal" class="modal-overlay hidden">
        <div class="modal-content large">
            <button class="close-button" id="closeMemberSettings">&times;</button>
            <h2>メンバーの所持・完凸設定</h2>
            
            <!-- プレイヤー名入力画面 -->
            <div id="playerNameInputScreen">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px;">プレイヤー名を入力してください：</label>
                    <input type="text" id="modalPlayerNameInput" placeholder="プレイヤー名" style="width: 100%; padding: 10px; box-sizing: border-box;">
                </div>
                <button id="goToSettingsButton" style="width: 100%; padding: 15px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">次へ</button>
            </div>
            
            <!-- プレイヤー選択エリア（非表示） -->
            <div class="member-select-row hidden" style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px;">
                <!-- JSで各プレイヤーのセレクトボックスを生成 -->
            </div>
            
            <div id="possessionTabs" class="hidden">
                <div class="tab-buttons" style="display: flex; gap: 5px; margin-bottom: 15px;">
                    <button class="tab-btn active" id="tab-char" onclick="showTab('charTab')">キャラクター</button>
                    <button class="tab-btn" id="tab-weapon" onclick="showTab('weaponTab')">武器</button>
                </div>
                <div id="charTab" class="tab-content">
                    <div class="tab-actions" style="margin-bottom: 10px;">
                        <button onclick="bulkCheck('char', true)">全所持</button>
                        <button onclick="bulkCheck('char', false)">全解除</button>
                    </div>
                    <div id="charSettingList" class="possession-grid"></div>
                </div>
                <div id="weaponTab" class="tab-content hidden">
                    <div class="tab-actions" style="margin-bottom: 10px;">
                        <button onclick="bulkCheck('weapon', true)">全所持</button>
                        <button onclick="bulkCheck('weapon', false)">全解除</button>
                    </div>
                    <div id="weaponSettingList" class="possession-grid"></div>
                </div>
                <button id="savePlayerData" class="save-btn" style="width: 100%; padding: 15px; background: #27ae60; margin-top: 20px;">この名前で保存する</button>
            </div>
        </div>
    </div>

    <!-- 7. About画面 -->
    <div id="aboutScreen" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="closeAboutButton" class="close-button">&times;</button>
            <h3>～このルーレットについて～</h3>
            <p>
                このルーレットは、普段遊んでいるサーバーでやっている縛り原神の縛りの抽選が大変だったのでそれをスムーズに作成者がいなくても誰でもできるようにしたい！という理念のもと作成しています。できることはボスの抽選、縛りプレイの抽選、縛りの内容の抽選です。プレイ人数は原神のマルチできる人数1～4人、縛りの数は現実的に可能な4つまでとしています。
            </p>
            
            <h3>～使い方～</h3>
            <p><strong>1. 人数と縛りの設定</strong><br>
                プレイヤー数と縛りの数をそれぞれ１～４まで選ぶことができます。また、プレイヤーの名前の部分を選択することで好きな名前を入力することができます。マルチプレイの際に活用してください。</p>
            <p><strong>2. 各ルーレットについて</strong><br>
                「ボス＋縛りルーレット」<br>
                　このルーレットでは、ボスと縛りをまとめて抽選することができます。縛りには個人に割り振られるものと全体で共通になっているものがあります。詳しくはカスタム縛り設定のところで確認することができます。<br>
                「ボスルーレットのみ」<br>
                　このルーレットではボスのみ抽選することができます<br>
                「縛りルーレットのみ」<br>
                　このルーレットでは縛りのみ抽選することができます<br>
                「詳細縛り設定」<br>
                　このルーレットでは縛りの中身のみをルーレットにすることができます。<br>
                「カスタム縛り設定」<br>
                　ここでは、自分で縛りの詳細を細かく設定することができます。<br>
                ※ルーレットで抽選された項目はポップアップにて表示されます。その際、ポップアップをクリックもしくはタップすると閉じることができます。
            </p>
            
            <h3>～各種縛りについて（全体共通）～</h3>
            <p><strong>全体共通縛り</strong><br>
                全体共通ではルーレットされるものとルールとして使用できなくなるものがあります。</p>
            <p><strong>国縛り</strong><br>
                原神で実装されている国がランダムで選ばれます。その後選ばれるキャラクターはその国出身のキャラクターになります。（判断基準は神の目のフレーム例：トーマ→稲妻、タルタリヤ→スネージナヤ）</p>
            <p><strong>モノ元素縛り</strong><br>
                七つの元素からランダムに１つが選ばれます。その後選ばれるキャラクターはその元素の神の目をもつキャラクターになります。</p>
            <p><strong>旅人縛り</strong><br>
                使えるキャラクターが蛍、空に固定となります。</p>
            <p><strong>恒常☆５縛り</strong><br>
                恒常ガチャで出てくる☆５キャラクターのみとなります。武器は好きなものを使って大丈夫です。</p>
            <p><strong>☆４キャラ武器</strong><br>
                キャラも武器も☆４以外は使えません。☆４以下の武器を使うのは好きにしていただいて大丈夫です。</p>
            <p><strong>初期キャラのみ</strong><br>
                Ver1.0で実装されたキャラクターのみ使用できる縛りです。</p>
            <p><strong>所持率100％縛り</strong><br>
                有志のサイトでまとめられていた所持率100％のキャラクターのみ使用できる縛りです。</p>
            <p><strong>配布武器縛り</strong><br>
                過去に期間限定イベントでのみ配布された武器しか使えないという縛りです。</p>
            <p><strong>スキル禁止</strong><br>
                スキルの使用ができません</p>
            <p><strong>完凸禁止</strong><br>
                完凸しているキャラクターは使用できません。</p>
            <p><strong>クラウン禁止</strong><br>
                知恵の王冠をつかっている部分を使用することができません。（スキルに使っている場合はスキル禁止）</p>
            <p><strong>回復禁止</strong><br>
                回復をすることができません。被ダメが0のときに回復する効果が発動してもセーフです。（緑の＋1000などが見えない限りセーフ）</p>
            <p><strong>誰か一人が倒れたら負け縛り</strong><br>
                PTの中で誰かがやられたらその時点で1からやりなおすという縛りです。</p>
            <p><strong>無凸縛り</strong><br>
                無凸のキャラクターのみしか使えません</p>
            <p><strong>聖遺物禁止</strong><br>
                聖遺物を持たせることができません</p>
            <p><strong>☆１、聖遺物なし</strong><br>
                ☆１武器かつ聖遺物をつけられないというしばりです。これが一番難しいです。（☆１武器がない場合一番レアリティが低いものをつかってください。ちなみに鍛冶屋で☆２武器は買えます。）</p>
            <p><strong>UI非表示+リロール</strong><br>
                UIを非表示にした状態で戦う+縛りをもう1つ増やすという縛りです。</p>
            <p><strong>爆発禁止+リロール</strong><br>
                元素爆発の使用ができない+縛りをもう1つ増やすという縛りです。</p>
            
            <h3>～各種縛りについて（個人）～</h3>
            <p><strong>個人の縛り</strong><br>
                個人の縛りはその項目がすべてルーレットされて最終的にキャラクターが抽選されます。</p>
            <p><strong>各1.1縛り</strong><br>
                各バージョンn.Nに実装されたキャラクターのみ使用できる縛りです。（N.0～だとほぼ国縛りで面白くないため、小数点のほうで縛っています）</p>
            <p><strong>体型縛り</strong><br>
                キャラクターのプレイアブルモデルで縛ります。</p>
            <p><strong>役割縛り</strong><br>
                幻想シアターで追加されたキャラクターの役割に基づいて縛ります。</p>
            <p><strong>元素エネルギー縛り</strong><br>
                キャラクターの元素爆発に必要なエネルギーの量で縛ります。（30はフリンズとヴァレサの2名ですが、この際は特殊爆発のみの縛りとします。逆に通常の爆発で抽選された場合は特殊爆発の使用はできません）</p>
            <p><strong>ボス素材縛り</strong><br>
                突破に必要なボス素材で縛ります。</p>
            <p><strong>特産品縛り</strong><br>
                突破に必要な特産品で縛ります。</p>
            <p><strong>突破ステータス縛り(キャラ)</strong><br>
                キャラクターの突破ステータスで縛ります。</p>
            <p><strong>突破ステータス縛り(武器)</strong><br>
                武器の突破ステータスで縛ります。</p>
            <p><strong>武器種縛り</strong><br>
                キャラクターの使える武器種でしばります。（法器、片手剣など）</p>
            <p><strong>誕生月縛り</strong><br>
                キャラクターのプロフィールにある誕生月で縛ります。（個人に依存する旅人は選ばれません）</p>
            <p><strong>アルファベット縛り</strong><br>
                各キャラクターを英語表記した際の頭文字で縛ります。</p>
            <p><strong>武器縛り</strong><br>
                全ての武器の中からランダムで1つ選ばれます。その武器を使えるキャラクターならだれでも大丈夫です。</p>
            <p><strong>配布キャラ縛り</strong><br>
                過去に期間限定イベントでのみ配布されたキャラクターしか使えないという縛りです。これはランダムで抽選されます。</p>
            <p><strong>キャラルーレット</strong><br>
                原神に実装されているプレイアブルキャラクターからランダムに選ばれ、そのキャラクターしか使えないという縛りです。</p>
            <p><strong>キャラ武器ルーレット</strong><br>
                キャラも武器もランダムに選ばれるという縛りです。</p>

            <h3>～Q＆A～</h3>
            <p><strong>Q: 所持していない武器が出たら？</strong><br>
                A: 「持っていない」ボタンでその武器を削除してもう一度ルーレットを回せます。</p>
            <p><strong>Q:各1.1縛りってなに？</strong><br>
                A:各キャラクターが実装されたバージョンの小数点第１位の値で縛るルーレットになっています。各バージョンで縛るよりバラエティに富んだキャラクターが引けるのでこっちのほうが楽しいという判断でこうなりました。</p>
            <p><strong>Q: 縛りの重複はどう処理？</strong><br>
                A: 重複しないようになっています。</p>
            <p><strong>Q: 条件の矛盾が出た場合は？</strong><br>
                A: 出ないようになっています。</p>
            <p><strong>Q: データミスを見つけたらどうすればいい？</strong><br>
                A: Twitter：<a href="https://x.com/rakiku_genshin" target="_blank" rel="noopener noreferrer">@rakiku_genshin</a> にDMでご報告ください。</p>

            <h3>～注意事項～</h3>
            <p>
                これは非公式のファンメイドツールです。アップデートは作者がやりたいときに頑張ります。作者がプログラムを組むのはこれが初めてなのでバグがめちゃくちゃあるかもしれませんがご容赦ください。<br>
                製作者Twitter:<a href="https://x.com/rakiku_genshin" target="_blank" rel="noopener noreferrer">@rakiku_genshin</a>
            </p>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
